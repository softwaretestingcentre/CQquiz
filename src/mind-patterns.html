<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mind Pattern Quiz</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 2em;
        background: #000;
        background-image: url("data:image/svg+xml;utf8,<svg width='1920' height='1080' xmlns='http://www.w3.org/2000/svg'><defs><radialGradient id='spark' cx='50%' cy='50%' r='50%'><stop offset='0%' stop-color='yellow' stop-opacity='0.95'/><stop offset='60%' stop-color='gold' stop-opacity='0.25'/><stop offset='100%' stop-color='black' stop-opacity='0.0'/></radialGradient></defs><circle cx='200' cy='180' r='22' fill='url(%23spark)'/><circle cx='400' cy='300' r='14' fill='url(%23spark)'/><circle cx='600' cy='120' r='18' fill='url(%23spark)'/><circle cx='800' cy='400' r='10' fill='url(%23spark)'/><circle cx='1000' cy='200' r='16' fill='url(%23spark)'/><circle cx='1200' cy='350' r='12' fill='url(%23spark)'/><circle cx='1400' cy='100' r='20' fill='url(%23spark)'/><circle cx='1600' cy='250' r='13' fill='url(%23spark)'/><circle cx='1800' cy='180' r='15' fill='url(%23spark)'/><circle cx='300' cy='700' r='11' fill='url(%23spark)'/><circle cx='500' cy='900' r='9' fill='url(%23spark)'/><circle cx='700' cy='800' r='13' fill='url(%23spark)'/><circle cx='900' cy='950' r='8' fill='url(%23spark)'/><circle cx='1100' cy='850' r='12' fill='url(%23spark)'/><circle cx='1300' cy='1000' r='10' fill='url(%23spark)'/><circle cx='1500' cy='900' r='14' fill='url(%23spark)'/><circle cx='1700' cy='1050' r='7' fill='url(%23spark)'/><circle cx='1900' cy='800' r='11' fill='url(%23spark)'/><circle cx='160' cy='950' r='8' fill='url(%23spark)'/><circle cx='1750' cy='500' r='10' fill='url(%23spark)'/></svg>");
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
      }
      h1, h2, h3, tbody {
        color: white;
      }
      .quiz-step {
        margin-bottom: 2em;
      }
      .options {
        display: flex;
        justify-content: space-between;
        gap: 1em;
        margin-bottom: 1em;
      }
      .options .option-card {
        flex: 1 1 0;
        margin: 0.5em 0;
        padding: 0.7em 0.5em;
        font-size: 1.1em;
        border-radius: 8px;
        border: 1px solid #222;
        background: #f3f3f3;
        color: #222;
        cursor: pointer;
        transition: background 0.2s, border 0.2s;
        user-select: none;
        text-align: center;
        word-break: break-word;
        white-space: normal;
        min-width: 0;
        max-width: 100%;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .options .option-key {
        font-weight: bold;
        font-size: larger;
        display: block;
        margin-top: 0.5em;
      }
      .options .option-card.selected {
        background: #cce5ff;
        border: 2px solid #339af0;
        font-weight: bold;
      }
      .options .option-card.disabled {
        opacity: 0.9;
        cursor: not-allowed;
        pointer-events: none;
      }
      .result {
        font-weight: bold;
        margin-top: 2em;
      }
      .details {
        margin-top: 1em;
        color: #555;
        font-size: small;
      }
      .long-description {
        margin-top: 1.5em;
        background: #f3f3f3;
        border: 1px solid #222;
        border-radius: 8px;
        padding: 1em 1.2em;
        color: #222;
        font-size: 1.08em;
        box-sizing: border-box;
        max-width: 100%;
        word-break: break-word;
        white-space: normal;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      .side-by-side {
        display: flex;
        flex-direction: row;
        gap: 2em;
        margin-top: 1.5em;
        margin-bottom: 1.5em;
        align-items: flex-start;
      }
      .gifts,
      .challenges {
        flex: 1 1 0;
        background: #f3f3f3;
        border: 1px solid #222;
        border-radius: 8px;
        padding: 1em 1.2em;
        color: #222;
        font-size: 1.08em;
        box-sizing: border-box;
        max-width: 100%;
        word-break: break-word;
        white-space: normal;
        min-width: 0;
      }
      .gifts {
        background: #e6f9e6 !important;
      }
      .challenges {
        background: #fff4e0 !important;
      }
    </style>
  </head>
  <body>
    <nav
      style="
        width: 95vw;
        min-width: 95%;
        background: #fffc66;
        border-bottom: 1.5px solid #ffe066;
        padding: 0.5em 0 0.5em 0.5em;
        position: relative;
        z-index: 10;
        box-shadow: 0 1px 4px #0001;
        display: flex;
        align-items: center;
        gap: 1.5em;
      "
    >
      <strong>COLLABORATIVE INTELLIGENCE</strong>
      <a
        href="mind-patterns.html"
        style="
          color: #111;
          text-decoration: none;
          font-weight: bold;
          font-size: 1.08em;
          padding: 0.2em 0.7em;
          border-radius: 6px;
          transition: background 0.15s;
          background: #fffb00;
        "
        >Mind Patterns</a
      >
      <a
        href="thinking-talents.html"
        style="
          color: #111;
          text-decoration: none;
          font-weight: bold;
          font-size: 1.08em;
          padding: 0.2em 0.7em;
          border-radius: 6px;
          transition: background 0.15s;
        "
        >Thinking Talents</a
      >
      <button
        id="reset-btn"
        style="
          margin-left: auto;
          margin-right: 1em;
          background: #fffbe6;
          color: #b30000;
          border: 1.5px solid #ffe066;
          border-radius: 7px;
          padding: 0.4em 1.2em;
          font-size: 1em;
          font-weight: bold;
          cursor: pointer;
          box-shadow: 0 2px 6px #0001;
          transition: background 0.15s;
        "
      >
        Reset
      </button>
    </nav>
    <h1>Mind Pattern Quiz</h1>
    <div id="quiz-container">
      <div id="step-1" class="quiz-step">
        <h2>Step 1</h2>
        <h3>Choose one of the cards below that seems most true for you:</h3>
        <div class="options" id="step-1-options"></div>
      </div>
      <div id="step-2" class="quiz-step" style="display: none">
        <h2>Step 2</h2>
        <h3>Choose which of the following two cards is most true for you:</h3>
        <div class="options" id="step-2-options"></div>
      </div>
      <div id="step-3" class="quiz-step" style="display: none">
        <h2>Step 3</h2>
        <h3>
          Read the final card and either confirm your choices or change them if
          you disagree:
        </h3>
        <div class="options" id="step-3-options"></div>
      </div>
      <h2 id="result" class="result" style="display: none"></h2>
      <button id="change-choices" style="display: none" onclick="resetQuiz()">
        Change Choices
      </button>
      <button id="confirm-choice" style="display: none" onclick="showDetails()">
        Confirm Choice
      </button>
      <div id="details" class="details" style="display: none"></div>
    </div>
    <script>
      let selectedOption1 = null;
      let selectedOption2 = null;
      let selectedOption3 = null;

      // Load selections from localStorage if present
      function loadSelections() {
        try {
          const saved = localStorage.getItem("mindPatternsSelections");
          if (saved) {
            const obj = JSON.parse(saved);
            if (obj && typeof obj === "object") {
              if ("selectedOption1" in obj)
                selectedOption1 = obj.selectedOption1;
              if ("selectedOption2" in obj)
                selectedOption2 = obj.selectedOption2;
              if ("selectedOption3" in obj)
                selectedOption3 = obj.selectedOption3;
            }
          }
        } catch (e) {}
      }

      // Save selections to localStorage
      function saveSelections() {
        try {
          localStorage.setItem(
            "mindPatternsSelections",
            JSON.stringify({
              selectedOption1,
              selectedOption2,
              selectedOption3,
            })
          );
        } catch (e) {}
      }

      loadSelections();

      // Step 2 options for each Step 1 choice
      const step2OptionsMap = {
        A1: ["K2", "V2"],
        V1: ["A2", "K2"],
        K1: ["V2", "A2"],
      };

      // Step 3 options for each Step 1 + Step 2 combination
      const step3OptionsMap = {
        A1: { K2: ["V3"], V2: ["K3"] },
        V1: { A2: ["K3"], K2: ["A3"] },
        K1: { V2: ["A3"], A2: ["V3"] },
      };

      // Mind Pattern results for each Step 1 + Step 2 combination
      const mindPatternMap = {
        A1: { K2: "AKV", V2: "AVK" },
        V1: { A2: "VAK", K2: "VKA" },
        K1: { V2: "KVA", A2: "KAV" },
      };

      let mindPatternStepDescriptions;
      (async () => {
        mindPatternStepDescriptions = (
          await import("./mindPatternStepDescriptions.js")
        ).mindPatternStepDescriptions;
        renderStep1Options();
        renderStep2Options();
        renderStep3Options();
      })();

      function addStepDescription(div, opt) {
        if (mindPatternStepDescriptions[opt]) {
          const descDiv = document.createElement("div");
          descDiv.innerHTML =
            mindPatternStepDescriptions[opt].pattern +
            mindPatternStepDescriptions[opt].description;
          descDiv.className = "details";
          div.appendChild(descDiv);
        }
      }

      function renderStep1Options() {
        const step1OptionsDiv = document.getElementById("step-1-options");
        step1OptionsDiv.innerHTML = "";
        ["A1", "V1", "K1"].forEach((opt) => {
          const div = document.createElement("div");
          let icon = "";
          if (opt[0] === "A") icon = "👂"; // Ear for Auditory
          else if (opt[0] === "V") icon = "👁️"; // Eye for Visual
          else if (opt[0] === "K") icon = "✋"; // Hand for Kinesthetic
          div.innerHTML = `<span style='font-size:1.5em;display:block;'>${icon}</span><span class='option-key'>${opt}</span>`;
          div.setAttribute("data-option", opt);
          div.className =
            "option-card" +
            (selectedOption1 === opt ? " selected" : "") +
            (selectedOption1 !== null ? " disabled" : "");
          div.onclick = () => {
            if (selectedOption1 === null) chooseOption1(opt);
          };
          step1OptionsDiv.appendChild(div);
          addStepDescription(div, opt);
        });
      }

      function renderStep2Options() {
        const step2OptionsDiv = document.getElementById("step-2-options");
        step2OptionsDiv.innerHTML = "";
        document.getElementById("step-2").style.display = "none";
        if (!selectedOption1) return;
        const options = step2OptionsMap[selectedOption1];
        options.forEach((opt) => {
          const div = document.createElement("div");
          let icon = "";
          if (opt[0] === "A") icon = "👂";
          else if (opt[0] === "V") icon = "👁️";
          else if (opt[0] === "K") icon = "✋";
          div.innerHTML = `<span style='font-size:1.5em;display:block;'>${icon}</span><span class='option-key'>${opt}</span>`;
          div.setAttribute("data-option", opt);
          div.className =
            "option-card" +
            (selectedOption2 === opt ? " selected" : "") +
            (selectedOption2 !== null ? " disabled" : "");
          div.onclick = () => {
            if (selectedOption2 === null) chooseOption2(opt);
          };
          step2OptionsDiv.appendChild(div);
          addStepDescription(div, opt);
        });
        document.getElementById("step-2").style.display = "block";
      }

      function renderStep3Options() {
        const step3Div = document.getElementById("step-3");
        const step3OptionsDiv = document.getElementById("step-3-options");
        step3OptionsDiv.innerHTML = "";
        if (!selectedOption1 || !selectedOption2) {
          step3Div.style.display = "none";
          document.getElementById("change-choices").style.display = "none";
          document.getElementById("confirm-choice").style.display = "none";
          return;
        }
        const options =
          step3OptionsMap[selectedOption1]?.[selectedOption2] || [];
        if (options.length === 0) {
          step3Div.style.display = "none";
          document.getElementById("change-choices").style.display = "none";
          document.getElementById("confirm-choice").style.display = "none";
          return;
        }
        step3Div.style.display = "block";
        // Show Change/Confirm buttons when Step 3 is visible
        document.getElementById("change-choices").style.display =
          "inline-block";
        document.getElementById("confirm-choice").style.display =
          "inline-block";
        // Show the only option as a static card
        const staticDiv = document.createElement("div");
        let icon = "";
        if (options[0]?.[0] === "A") icon = "👂";
        else if (options[0]?.[0] === "V") icon = "👁️";
        else if (options[0]?.[0] === "K") icon = "✋";
        staticDiv.innerHTML = `<span style='font-size:1.5em;display:block;'>${icon}</span><span class='option-key'>${options[0]}</span>`;
        staticDiv.setAttribute("data-option", options[0]);
        staticDiv.className = "option-card selected";
        staticDiv.onclick = () => {
          showDetails();
        };
        addStepDescription(staticDiv, options[0]);
        step3OptionsDiv.appendChild(staticDiv);
      }

      function chooseOption1(option) {
        selectedOption1 = option;
        selectedOption2 = null;
        selectedOption3 = null;
        renderStep1Options();
        renderStep2Options();
        renderStep3Options();
        // Clear result/details if changing
        document.getElementById("result").style.display = "none";
        document.getElementById("details").style.display = "none";
        document.getElementById("change-choices").style.display = "none";
        document.getElementById("confirm-choice").style.display = "none";
        saveSelections();
      }

      function chooseOption2(option) {
        selectedOption2 = option;
        selectedOption3 = null;
        renderStep2Options();
        renderStep3Options();
        // Only show result after step 3
        saveSelections();
      }

      function showResult() {
        if (!selectedOption1 || !selectedOption2) return;
        const resultDiv = document.getElementById("result");
        let mindPattern = "";
        if (
          mindPatternMap[selectedOption1] &&
          mindPatternMap[selectedOption1][selectedOption2]
        ) {
          mindPattern = mindPatternMap[selectedOption1][selectedOption2];
        } else {
          mindPattern = `${selectedOption1} + ${selectedOption2}`;
        }
        resultDiv.textContent = `Your Mind Pattern: ${mindPattern}`;
        resultDiv.style.display = "block";
      }

      function resetQuiz() {
        selectedOption1 = null;
        selectedOption2 = null;
        selectedOption3 = null;
        document.getElementById("result").style.display = "none";
        document.getElementById("details").style.display = "none";
        document.getElementById("change-choices").style.display = "none";
        document.getElementById("confirm-choice").style.display = "none";
        renderStep1Options();
        renderStep2Options();
        renderStep3Options();
        saveSelections();
      }

      function showDetails() {
        saveSelections();
        const detailsDiv = document.getElementById("details");
        // Determine the 3 choices
        const step1 = selectedOption1;
        const step2 = selectedOption2;
        const step3 =
          step3OptionsMap[selectedOption1]?.[selectedOption2]?.[0] || "";
        // Determine the pattern code (e.g. VAK)
        let mindPattern = "";
        if (
          mindPatternMap[selectedOption1] &&
          mindPatternMap[selectedOption1][selectedOption2]
        ) {
          mindPattern = mindPatternMap[selectedOption1][selectedOption2];
        } else {
          mindPattern = `${selectedOption1} + ${selectedOption2}`;
        }

        // Helper to get icon for a code
        function iconFor(opt) {
          if (!opt) return "";
          if (opt[0] === "A") return "👂";
          if (opt[0] === "V") return "👁️";
          if (opt[0] === "K") return "✋";
          return "";
        }

        // Build table HTML
        let html = `<h1>${mindPattern} Pattern</h1>
        <table style="border-collapse:collapse;width:auto;font-weight:bold;">`;
        const thinkingTypes = [
          "FOCUSED THINKING",
          "SORTING THINKING",
          "OPEN THINKING",
        ];
        const triggers = [
          "To Trigger Concentration:",
          "To Trigger Sorting:",
          "To Trigger Imagination:",
        ];
        [[step1], [step2], [step3]].forEach((optArr, idx) => {
          const opt = optArr[0];
          let channel = "";
          if (opt && opt[0] === "V") channel = "VISUAL";
          else if (opt && opt[0] === "A") channel = "AUDITORY";
          else if (opt && opt[0] === "K") channel = "KINESTHETIC";
          html += `<tr>`;
          html += `<td style='padding:0.3em 1em;border:1px solid #bbb;'>${
            opt || ""
          }</td>`;
          html += `<td style='padding:0.3em 1em;border:1px solid #bbb;font-size:1.3em;'>${iconFor(
            opt
          )}</td>`;
          html += `<td style='padding:0.3em 1em;border:1px solid #bbb;'>${thinkingTypes[idx]}</td>`;
          html += `<td style='padding:0.3em 1em;border:1px solid #bbb;'>${
            triggers[idx]
          }<br />${channel ? " " + channel : ""}</td>`;
          html += `</tr>`;
        });
        html += `</table>`;
        html += `<div class='long-description'>${mindPatternStepDescriptions[mindPattern].longDescription}</div>`;

        html += `<h2>${mindPattern} Attributes</h2>`;
        html += `<table style="border-collapse:collapse;width:auto;font-weight:bold;padding:0.3em 1em;border:1px solid #bbb;">`;
        html += `<tr><td>Easiest Way to Learn</td><td>${mindPatternStepDescriptions[mindPattern].learning}</td></tr>`;
        html += `<tr><td>Easiest Way to Express</td><td>${mindPatternStepDescriptions[mindPattern].expressing}</td></tr>`;
        html += `<tr><td>Language Attributes</td><td>${mindPatternStepDescriptions[mindPattern].language}</td></tr>`;
        html += `<tr><td>Visual Attributes</td><td>${mindPatternStepDescriptions[mindPattern].visual}</td></tr>`;
        html += `<tr><td>Physical Attributes</td><td>${mindPatternStepDescriptions[mindPattern].physical}</td></tr>`;
        html += `<tr><td>Natural Traits</td>
            <td style='vertical-align:top;padding-top:0;text-align:left;padding-inline-start: 40px;'>${mindPatternStepDescriptions[mindPattern].traits}</td></tr>`;
        html += `<tr><td>Frustrations</td>
              <td style='vertical-align:top;padding-top:0;text-align:left;padding-inline-start: 40px;'>${mindPatternStepDescriptions[mindPattern].frustrations}</td></tr>`;
        html += `<tr><td>Spaces Out</td>
                <td style='vertical-align:top;padding-top:0;text-align:left;padding-inline-start: 40px;'>${mindPatternStepDescriptions[mindPattern].spacing_out}</td></tr>`;
        html += `</table>`;

        html += `<div class='side-by-side'>`;
        html += `<div class='gifts'><h4>${mindPattern} Gifts and Strengths</h4>${mindPatternStepDescriptions[mindPattern].gifts}</div>`;
        html += `<div class='challenges'><h4>${mindPattern} Challenges</h4>${mindPatternStepDescriptions[mindPattern].challenges}</div>`;
        html += `</div>`;

        html += `<h2>${mindPattern} Breakdowns and Adjustments</h2>`;
        html += `<table>
          <thead>
            <tr style='font-weight:bold;'>
              <th style='background:#f5f5f5;border:1px solid #222;padding:0.7em 1.2em;'>Common Breakdown</th>
              <th style='background:#f5f5f5;border:1px solid #222;padding:0.7em 1.2em;'>Adjustment Possibilities</th>
            </tr>
          </thead>
          <tbody>`;
        mindPatternStepDescriptions[mindPattern].breakdown.forEach(
          (breakdown, index) => {
            html += `<tr>
              <td style='border:1px solid #222;padding:0.7em 1.2em;'>${breakdown}</td>
              <td style='border:1px solid #222;padding:0.7em 1.2em;'>${mindPatternStepDescriptions[mindPattern].adjustment[index]}</td>
            </tr>`;
          }
        );
        html += `</tbody>`;
        html += `</table>`;

        html += `<h2>Coping with ${mindPattern} Challenges</h2>`;
        html += `<table><thead>
            <tr style='font-weight:bold;'>
              <th style='background:#f5f5f5;border:1px solid #222;padding:0.7em 1.2em;'>Presentations</th>
              <th style='background:#f5f5f5;border:1px solid #222;padding:0.7em 1.2em;'>Performance Reviews</th>
              <th style='background:#f5f5f5;border:1px solid #222;padding:0.7em 1.2em;'>Conflict</th>
            </tr>
          </thead>`;
        html += `<tbody>`;
        html += `<tr>
            <td style='border:1px solid #222;padding:0.7em 1.2em;'>${mindPatternStepDescriptions[mindPattern].presentations}</td>
            <td style='border:1px solid #222;padding:0.7em 1.2em;'>${mindPatternStepDescriptions[mindPattern].performance_reviews}</td>
            <td style='border:1px solid #222;padding:0.7em 1.2em;'>${mindPatternStepDescriptions[mindPattern].conflict}</td>
        </tr>`;
        html += `</tbody>`;
        html += `</table>`;

        detailsDiv.innerHTML = html;
        detailsDiv.style.display = "block";
      }
      // Initial render now handled after dynamic import

      // Add reset button handler
      document.addEventListener("DOMContentLoaded", function () {
        const resetBtn = document.getElementById("reset-btn");
        if (resetBtn) {
          resetBtn.onclick = function () {
            if (confirm("Are you sure you want to reset your selections?")) {
              localStorage.removeItem("mindPatternsSelections");
              location.reload();
            }
          };
        }
      });
    </script>
  </body>
</html>
